# I. Архитектура и системные файлы

## 1. Цель модуля
Создать фундамент проекта: структуру директорий, системные файлы, документацию и логику фиксации версий.  
Модуль формирует основу, на которой строятся backend, frontend и автоматизация процессов.

---

## Подмодуль 1.1 — Project Init
**Описание:**  
Первичная инициализация проекта и создание базовой структуры каталогов.  
Настройка окружения для разработки, подготовка системных зависимостей и контрольных файлов.

**Результат:**  
Создана структура `/frontend`, `/backend`, `/notes`, корректно настроено окружение, проект готов к разработке.

### Задачи

#### GPT
- [x] Сгенерировать структуру директорий (`/frontend`, `/backend`, `/notes`, `/assets`, `/scripts`).
- [x] Создать шаблоны системных файлов (README, LICENSE, .gitignore).
- [x] Проверить корректность структуры и описания.
#### Codex
- [x] Инициализировать проект через CLI (npm init, python init, и т.д.).
- [x] Настроить окружение разработки (venv, node_modules, .env.example).
- [x] Добавить базовые зависимости (eslint, prettier, dotenv и т.д.).
#### Серджиу
- [x] Проверить права доступа к каталогам и файлам.
- [x] Провести smoke-тест запуска окружения.
- [x] Подтвердить, что структура соответствует требованиям.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v1.0] Context Lock — Project Init complete (2025-10-15)
**Описание:** Завершена инициализация проекта и подготовлено рабочее окружение.

### Выполнено
- Созданы каталоги проекта `/frontend`, `/backend`, `/notes`, `/assets`, `/scripts`.
- Настроено окружение разработки: ESLint, Prettier, FastAPI, dotenv.
- Добавлены системные файлы: `.gitignore`, `.env.example`, `LICENSE`, `README.md`.
- Backend и frontend окружения инициализированы и проверены.
- GitHub-репозиторий подключён, первый commit зафиксирован.
- Все задачи подмодуля 1.1 выполнены (GPT, Codex, Серджиу).
- Проведена ревизия файлов notes — структура и состояние проекта актуальны.

**Результат:**  
###### Context Lock v1.0 установлен. Проект полностью готов к переходу в подмодуль 1.2 “Notes System”.
---

## Подмодуль 1.2 — Notes System
**Описание:**  
Создание и настройка основной документационной системы проекта.  
Формируются файлы, которые обеспечивают полную прозрачность и контроль архитектуры.

**Включает:**
- `project_plan.md` — архитектура и дорожная карта.
- `tasks.md` — модульная структура задач.
- `changelog.md` — история изменений и ревизий.
- `readme.md` — общее описание и цели проекта.

**Результат:**  
Система документации связана между собой, GPT и Codex работают в едином контексте.

### Задачи

#### GPT
- [x] Сгенерировать шаблоны всех ключевых файлов notes (`project_plan.md`, `tasks.md`, `changelog.md`, `readme.md`).
- [x] Описать структуру связей между файлами.
- [x] Обеспечить единый стиль документации.
#### Codex
- [x] Создать физические файлы в `/notes`.
- [x] Настроить автосохранение и резервное копирование notes.
- [x] Проверить доступность файлов для редактирования.
#### Серджиу
- [x] Провести ревизию файлов на наличие ошибок и дубликатов.
- [x] Проверить соответствие структуры документации архитектуре проекта.
- [x] Подтвердить корректную работу системы notes.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v1.2] Context Lock — Notes System stable (2025-10-16)
**Описание:** Проверена и подтверждена стабильность системы notes после внедрения автосохранения и резервного копирования.

### Выполнено
- Успешно проведено тестирование чтения и записи всех файлов notes.
- Автосохранение работает корректно, резервные копии создаются автоматически.
- Структура проекта синхронизирована с архитектурным планом.
- Система notes стабильна и готова к дальнейшему развитию.

**Результат:**  
Контекст проекта зафиксирован в состоянии стабильности (v1.2). Разрешён переход к подмодулю 1.3 “Context Lock Core”.

---

## Подмодуль 1.3 — Context Lock Core
**Описание:**  
Реализация механизма “заморозки состояния проекта” — Context Lock.  
Определяется структура commit-процессов и фиксации версий проекта (v1.0, v2.0, и т.д.).

**Включает:**
- Определение формата фиксации (`Context Lock vX.X`).
- Протокол commit’ов и Git push.
- Проверку целостности файлов `/notes/`.

**Результат:**  
Проект получает систему версионирования, позволяющую фиксировать и восстанавливать архитектурное состояние.

### Задачи

#### GPT
- [x] Описать формат фиксации Context Lock (`Context Lock vX.X`).
- [x] Сформулировать протокол commit’ов и push-процедуры.
- [x] Составить инструкцию по восстановлению состояния по Context Lock.
#### Codex
- [x] Реализовать шаблон commit-сообщений.
- [x] Настроить автоматическую проверку целостности файлов `/notes/`.
- [x] Добавить скрипт для фиксации новой версии Context Lock.
- [x] Оптимизировать хранение Context Lock (архив вместо дубликатов).

**Финальный commit:**  
`[version] Context Lock v1.4 — Zip archive optimization`
#### Серджиу
- [x] Провести тестовый Context Lock (freeze/unfreeze).
- [x] Проверить восстановление состояния проекта из notes.
- [x] Подтвердить работоспособность протокола.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v1.4] Context Lock — Zip archive optimization (2025-10-16)
**Описание:** Механизм Context Lock оптимизирован, теперь каждая версия хранится в одном архиве (.zip).

### Выполнено
- Обновлён скрипт `lock_version.sh` для создания архивов версий.
- Удалён механизм множественного копирования файлов notes.
- Теперь каждая версия Context Lock сохраняется в `/notes/backups/` как `.zip`-архив.
- Проверена работа архивации и восстановления (freeze/unfreeze).
- Обновлены changelog и tasks.

**Результат:**  
Context Lock работает стабильно в архивном формате. Система полностью готова к масштабированию и дальнейшим ревизиям.

---

## Подмодуль 1.4 — Архитектурная структура директорий
**Описание:**  
Создание и документирование дерева каталогов проекта.  
Определяются базовые пути, соглашения по именованию и структура хранения файлов.

**Включает:**
- `/frontend` — интерфейсная часть.
- `/backend` — серверная логика и API.
- `/notes` — текстовые файлы архитектуры.
- `/assets` — ресурсы (при необходимости).
- `/scripts` — вспомогательные утилиты и автоматизация.

**Результат:**  
Единая структура директорий, обеспечивающая прозрачную навигацию и масштабируемость.

### Задачи

#### GPT
- [x] Сгенерировать схему дерева каталогов (tree).
- [x] Описать правила именования директорий и файлов.
- [x] Подготовить документацию по структуре для notes.
#### Codex
- [x] Создать каталоги согласно схеме.
- [x] Проверить наличие всех необходимых путей.
- [x] Настроить автосоздание недостающих директорий.
#### Серджиу
- [x] Проверить соответствие структуры каталога документации.
- [x] Провести навигационный тест (поиск файлов/директорий).
- [x] Подтвердить масштабируемость структуры для будущих модулей.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v1.5] Context Lock — Project Structure Control (2025-10-17)
**Описание:** Проведена финальная ревизия подмодуля 1.4. Подтверждена корректность и масштабируемость структуры директорий проекта.

### Выполнено
- Проведён навигационный тест (все каталоги доступны и легко находятся).
- Проверена работа скрипта `check_structure.sh` и pre-commit hook.
- Подтверждена масштабируемость структуры: добавление новых модулей не нарушает архитектуру.
- Зафиксировано дерево каталогов в `project_plan.md` и `project_structure.txt`.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v1.5 подтверждён. Структура проекта стабильна, масштабируема и контролируется автоматически.


---

## Подмодуль 1.5 — Git и среда разработки
**Описание:**  
Настройка Git-репозитория, ветвления, commit-конвенций и интеграции с VS Code.  
Определяются правила фиксации изменений и ведения веток.

**Включает:**
- Стандарт ветвления (main / dev / feature).
- Конвенции commit-сообщений.
- Настройку `.gitignore` и `.env`.
- Автоматическую синхронизацию с Codex.

**Результат:**  
Репозиторий готов к активной работе, обеспечен контроль версий и чистая история изменений.

### Задачи

#### GPT
- [x] Описать стандарты ветвления и commit-конвенции.
- [x] Сгенерировать шаблоны `.gitignore` и `.env.example`.
- [x] Подготовить инструкцию по работе с репозиторием.
#### Codex
- [x] Инициализировать git-репозиторий.
- [x] Настроить ветки main / dev / feature.
- [x] Интегрировать VS Code с git и Codex.
#### Серджиу
- [x] Проверить корректность работы git (commit, push, merge).
- [x] Провести ревизию истории изменений.
- [x] Подтвердить синхронизацию с Codex.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v1.6] Context Lock — Git Workflow and Dev Environment setup (2025-10-17)
**Описание:** Проведена ревизия подмодуля 1.5. Настроена система ветвления и commit-конвенций, интегрирована среда Git с VS Code и Codex.

### Выполнено
- Настроены ветки main / dev / feature и проверены merge-процессы.
- Добавлены commit-конвенции и автоматическая проверка сообщений (husky, lint-staged).
- Обновлены `.gitignore` и `.env.example`.
- VS Code синхронизирован с Git и Codex.
- В README и notes/readme.md добавлены разделы "Git Workflow".
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v1.6 установлен. Система Git полностью интегрирована и стандартизирована. Проект готов к переходу в подмодуль 1.6 “Системная документация и ревизии”.

---

## Подмодуль 1.6 — Системная документация и ревизии
**Описание:**  
Создание шаблонов внутренних документов и ревизионных инструкций для GPT.  
Включает базовые протоколы проверки актуальности файлов и синхронизации данных.

**Включает:**
- Протокол проверки целостности notes.
- Формат обновления changelog.
- Инструкции для GPT по ревизии состояния проекта.

**Результат:**  
GPT получает возможность выполнять ревизию архитектуры и синхронизировать состояние всех notes с фактическим кодом проекта.

### Задачи

#### GPT
- [x] Сформулировать протокол проверки целостности notes.
- [x] Описать формат changelog и правила его ведения.
- [x] Составить инструкции для автоматической ревизии состояния проекта.
#### Codex
- [x] Реализовать шаблоны changelog и ревизионных файлов.
- [x] Настроить автоматическую проверку изменений notes.
- [x] Добавить скрипты для сверки актуальности файлов.
#### Серджиу
- [x] Провести тестовую ревизию всех notes.
- [x] Проверить корректность changelog после изменений.
- [x] Подтвердить возможность синхронизации notes с кодом проекта.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

**Итог:**  
Модуль I создаёт фундамент проекта: системную структуру, документацию, Git-настройку и механизм Context Lock.  
После выполнения всех подмодулей система готова к переходу в модуль Backend (II).

## [v1.7] Context Lock — System Documentation and Revisions (2025-10-17)
**Описание:** Проведена ревизия подмодуля 1.6. Настроена система автоматической проверки и синхронизации notes.

### Выполнено
- Добавлены скрипты `revision_check.sh` и `sync_notes.py`.
- Создан шаблон ревизионного протокола `revision_protocol.md`.
- Автоматическая ревизия сверяет все ключевые файлы notes.
- Система успешно протестирована и подтвердила актуальность всех данных.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v1.7 подтверждён. Модуль I завершён и готов к переходу в Модуль II “Backend — база данных, API и логика”.


# II. Backend — база данных, API и логика

## 1. Цель модуля
Разработать серверную часть проекта, включающую архитектуру базы данных, REST API, систему платежей и защиту.  
Модуль обеспечивает устойчивость и логику всей платформы: управление пользователями, заказами, транзакциями и интеграциями.

---

## Подмодуль 2.1 — Database & ORM
**Описание:**  
Создание базы данных и моделей данных на основе архитектуры из `project_plan.md`.  
Определяются все ключевые таблицы, связи и индексы для работы с пользователями, заказами, видео и транзакциями.

**Включает:**
- Настройку PostgreSQL (или аналогичной СУБД).  
- Реализацию ORM (Prisma или SQLAlchemy).  
- Определение сущностей: User, Campaign, Application, Order, Video, Payment, Rating, Report.  
- Настройку миграций и первичных ключей.

**Результат:**  
База данных полностью структурирована и готова к интеграции с API.

### Задачи

#### GPT
- [x] Спроектировать модели данных для всех сущностей (User, Campaign, Application, Order, Video, Payment, Rating, Report).
- [x] Описать связи между таблицами и индексацию.
- [x] Сформулировать документацию по структуре БД.
#### Codex
- [x] Реализовать модели в выбранном ORM (Prisma/SQLAlchemy).
- [x] Настроить миграции для создания всех таблиц и связей.
- [x] Проверить корректность миграций и схемы БД.
#### Серджиу
- [x] Провести smoke-тест миграций на тестовой базе.
- [x] Проверить соответствие моделей документации.
- [x] Подтвердить готовность БД к интеграции с API.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”
---

## Подмодуль 2.2 — REST API
**Описание:**  
Реализация REST API на Node.js (Express/Fastify) или Python (FastAPI) с маршрутами, описанными в архитектуре.  
Обеспечивается стандарт обмена JSON и централизованная обработка ошибок.

**Включает:**
- Auth (регистрация, логин, refresh).  
- Campaigns (создание, редактирование, фильтрация).  
- Applications (отклики и отклонения).  
- Orders (статусы, связь с видео).  
- Payments (escrow, выплаты).  
- Notifications (уведомления пользователей).  

**Результат:**  
API покрывает все ключевые сценарии работы платформы.

### Задачи

#### GPT
- [x] Описать спецификацию маршрутов REST API для всех сущностей.
- [x] Сформулировать примеры запросов и ответов (JSON).
- [x] Подготовить документацию по API (Swagger/OpenAPI).
#### Codex
- [x] Реализовать основные маршруты (Auth, Campaigns, Applications, Orders, Payments, Notifications).
- [x] Настроить централизованную обработку ошибок.
- [x] Написать unit-тесты для ключевых эндпоинтов.
#### Серджиу
- [x] Провести интеграционное тестирование маршрутов.
- [x] Проверить соответствие реализации документации.
- [x] Подтвердить стабильную работу API во всех сценариях.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”


## [v2.2] Context Lock — REST API verified and database integration complete (2025-10-18)
**Описание:** Проведена успешная ревизия подмодуля 2.2. Все маршруты REST API проверены вручную через Swagger UI.

### Выполнено
- Успешная регистрация пользователя (код 201).
- Авторизация и получение JWT-токена (код 200).
- Запрос списка кампаний возвращает корректные данные (код 200).
- Подтверждена корректная работа моделей и валидации данных (пароль ≥ 8 символов, обязательные поля).
- Проверена связка API ↔ база данных.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v2.2 подтверждён. REST API функционирует стабильно и готов к дальнейшей интеграции (Frontend и Webhooks).

---

## Подмодуль 2.3 — Notifications & Webhooks
**Описание:**  
Реализация системы пользовательских уведомлений и интеграции внешних событий через webhooks.

**Включает:**
- Модель `Notification` и REST-эндпоинты для чтения и отметки уведомлений.
- Фоновую доставку уведомлений при создании кампаний, платежах, изменении статусов заказов.
- Обработчики `POST /api/webhooks/payment` и `POST /api/webhooks/order` с валидацией и логированием.
- Таблицу `WebhookEvent` для аудита входящих событий.

**Результат:**  
Пользователи получают актуальные уведомления, а внешние сервисы могут безопасно обновлять статусы через webhook-интеграцию.

### Задачи

#### GPT
- [x] Спроектировать модели и схему взаимодействия уведомлений и webhook'ов.
- [x] Описать payload'ы и сценарии обработки внешних событий.
- [x] Обновить документацию (project_plan, readme) разделом Notifications & Webhooks.
#### Codex
- [x] Реализовать маршруты `/api/notifications`, `/api/notifications/mark-read`, `/api/webhooks/*`.
- [x] Настроить фоновые задачи для создания уведомлений.
- [x] Написать тесты для уведомлений и webhook-эндпоинтов.
- [x] Пересоздать миграции и восстановить базу данных (Context Lock v2.3 database reset).
#### Серджиу
- [x] Провести интеграционное тестирование уведомлений и webhook'ов.
- [x] Проверить доставку уведомлений в интерфейсе.
- [x] Подтвердить корректность журналирования событий.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v2.3] Context Lock — Notifications & Webhooks verified (2025-10-18)
**Описание:** Завершена успешная ревизия подмодуля 2.3. Система уведомлений и webhook-интеграций полностью протестирована и подтверждена в работе.

### Выполнено
- Проведено интеграционное тестирование уведомлений и webhook'ов.
- Проверена автоматическая генерация уведомлений при создании кампаний и webhook-событиях.
- Подтверждена работа авторизации через JWT и отображение уведомлений в Swagger UI.
- Успешно протестированы маршруты `/api/notifications`, `/api/webhooks/payment`, `/api/webhooks/order`.
- Проведена ревизия миграций и базы данных после пересоздания Context Lock v2.3.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v2.3 подтверждён. Модуль Notifications & Webhooks полностью завершён и готов к переходу в модуль 2.4 “Security & Middleware”.
---

## Подмодуль 2.4 — Security & Middleware
**Описание:**  
Реализация системы безопасности и промежуточных слоёв API.  
Настройка JWT, CORS, rate-limiter и валидации входящих данных.

**Включает:**
- Аутентификацию через JWT (access/refresh токены).  
- Валидацию схем (Joi, Pydantic или Zod).  
- CORS и ограничение доменов.  
- Rate limiter для защиты от спама.  
- Стандартизированные ошибки и middleware логирования.

**Результат:**  
API защищён и стабилен, все запросы проходят валидацию и контроль авторизации.

### Задачи

#### GPT
- [x] Описать требования к безопасности и middleware (JWT, CORS, валидация, rate-limiter).
- [x] Сформулировать схемы валидации для всех сущностей.
- [x] Подготовить документацию по слоям защиты API.
#### Codex
- [x] Реализовать JWT-аутентификацию (access/refresh).
- [x] Настроить CORS и ограничение доменов.
- [x] Имплементировать валидацию входящих данных и rate-limiter.
#### Серджиу
- [x] Провести тестирование защиты (авторизация, rate-limit, CORS).
- [x] Проверить устойчивость к типовым атакам (XSS, CSRF, brute-force).
- [x] Подтвердить корректность работы middleware.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v2.4] Context Lock — Security & Middleware verified (2025-10-18)
**Описание:** Проведена финальная ревизия подмодуля 2.4. Подтверждена корректная работа JWT-аутентификации, middleware и защиты API.

### Выполнено
- Проверена аутентификация (access/refresh/logout/refresh revoke).
- JWT работает корректно, токены обновляются и аннулируются по logout.
- Rate limiter ограничивает 60 запросов/минуту.
- CORS фильтрует запросы с неразрешённых доменов.
- Middleware логирует все запросы в `logs/app.log`.
- Swagger UI отображает кнопку Authorize и корректно принимает токен.
- Проведена ревизия безопасности и устойчивости к атакам (CSRF, brute-force).
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v2.4 подтверждён. Система безопасности и middleware полностью функционируют и готовы к интеграции с модулем 2.5 “Admin API Layer”.
---

## Подмодуль 2.5 — Admin API Layer
**Описание:**  
Создание админского уровня API для модераторов, финансовых админов и суперпользователей.  
Определяется доступ к расширенным маршрутам и действиям с пользователями и кампаниями.

**Включает:**
- Роли (admin_level_1 / admin_level_2 / admin_level_3).  
- Маршруты `/api/admin/users`, `/api/admin/campaigns`, `/api/admin/statistics`.  
- Доступ только по JWT с ролью “admin”.  
- Отчёты по кампаниям и пользователям.

**Результат:**  
Админ-панель получает серверную поддержку и возможность централизованного управления системой.

### Задачи

#### GPT
- [x] Описать структуру маршрутов и ролей для админского API.
- [x] Сформулировать правила доступа и разграничения прав.
- [x] Подготовить документацию по админским возможностям.
#### Codex
- [x] Реализовать маршруты `/api/admin/users`, `/api/admin/campaigns`, `/api/admin/statistics`.
- [x] Настроить проверку JWT и ролей для доступа к админским методам.
- [x] Добавить генерацию отчётов по кампаниям и пользователям.
#### Серджиу
- [x] Провести тестирование прав доступа и маршрутов.
- [x] Проверить корректность генерации отчётов.
- [x] Подтвердить безопасность админского уровня API.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v2.5] Context Lock — Admin API Layer verified (2025-10-19)
**Описание:** Проведена ревизия подмодуля 2.5. Проверены маршруты и права доступа админского уровня API.

### Выполнено
- Проверены маршруты `/api/admin/users`, `/api/admin/campaigns`, `/api/admin/statistics`.
- JWT-аутентификация и разграничение по ролям работают корректно (admin_level_1/2/3).
- Генерация отчётов по пользователям и кампаниям протестирована.
- Проведены тесты безопасности и устойчивости админского API.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v2.5 подтверждён. Серверная поддержка админ-панели реализована и готова к интеграции с event-системой.


---

## Подмодуль 2.6 — Event System & Webhooks
**Описание:**  
Реализация событийной системы и обработчиков внешних уведомлений (банков, Telegram, интеграций).  
Обеспечивается асинхронная обработка событий для улучшения производительности.

**Включает:**
- Вебхуки: `/api/webhooks/bank`, `/api/webhooks/telegram`.  
- Очередь фоновых задач (BullMQ, Celery).  
- Cron-задачи для обновления метрик.  
- Систему логирования событий.

**Результат:**  
Система умеет реагировать на внешние события и обновлять данные в реальном времени.

### Задачи

#### GPT
- [x] Описать архитектуру событийной системы и очередей.
- [x] Сформулировать схемы для вебхуков и фоновых задач.
- [x] Подготовить документацию по логированию событий.
#### Codex
- [x] Реализовать обработчики вебхуков `/api/webhooks/bank`, `/api/webhooks/telegram`.
- [x] Настроить очередь фоновых задач и cron-задачи.
- [x] Имплементировать систему логирования событий.
#### Серджиу
- [x] Провести тестирование обработки внешних событий.
- [x] Проверить корректность работы фоновых задач и очередей.
- [x] Подтвердить наличие и полноту логов событий.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v2.6] Context Lock — Event System & Webhooks verified (2025-10-20)
**Описание:** Проведена финальная ревизия подмодуля 2.6. Подтверждена корректная работа внутренней событийной системы и mock-интеграций вебхуков.

### Выполнено
- Реализован EventBus и EventLog для публикации и логирования событий.
- Настроена очередь фоновых задач и cron-задачи (пересчёт статистики, очистка логов).
- Webhook-обработчики `/api/webhooks/bank` и `/api/webhooks/telegram` успешно протестированы.
- Все события логируются в базу данных и файл `logs/events.log`.
- Подтверждена работа шины событий и системы логирования.
- 29.10.2025 — система восстановлена автоматически, cron-задачи APScheduler и агрегированные метрики (`event_stats.json`) подтверждены.
- Обновлены changelog и tasks.

**Результат:**  
###### Context Lock v2.6 подтверждён. Event System полностью функционирует, cron-задачи активны, система готова к интеграции с внешними сервисами (Telegram, банк).
---

## Подмодуль 2.7 — Testing & Monitoring
**Описание:**  
Создание и настройка системы тестирования, логирования и мониторинга работы backend.  
Включает покрытие тестами критичных модулей API и мониторинг ошибок.

**Включает:**
- Unit-тесты и интеграционные тесты (Jest / PyTest).  
- Логирование запросов (Winston / Loguru).  
- Мониторинг uptime и производительности (Grafana / Prometheus).  
- Скрипты деплоя на staging.

**Результат:**  
Backend проходит проверку стабильности, производительности и корректности API перед интеграцией с фронтендом.

### Задачи

#### GPT
- [x] Описать стратегию тестирования и мониторинга backend.
- [x] Сформулировать критерии покрытия тестами и метрик мониторинга.
- [x] Подготовить шаблоны отчётов по тестированию и мониторингу.
#### Codex
- [x] Реализовать unit- и интеграционные тесты (Jest/PyTest) для критичных модулей.
- [x] Настроить логирование запросов и ошибок (Winston/Loguru).
- [x] Интегрировать мониторинг uptime и производительности (Grafana/Prometheus).
#### Серджиу
- [x] Провести тестирование всех сценариев API.
- [x] Проверить отчёты мониторинга и логирования.
- [x] Подтвердить готовность backend к интеграции с frontend.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”

**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v2.7] Context Lock — Testing & Monitoring verified (2025-10-21)
**Описание:** Проведена финальная ревизия подмодуля 2.7. Подтверждена корректная работа системы тестирования, логирования и мониторинга backend.

### Выполнено
- Переписаны PyTest-сценарии под текущую архитектуру (`auth`, `notifications`, `webhooks`, `system`).
- Настроено логирование через Loguru (`logs/app.log`, `logs/errors.log`).
- Эндпоинты `/api/system/health` и `/api/system/metrics` возвращают актуальные метрики (uptime, requests_per_min, errors).
- Проверено логирование событий и создание файлов `event_stats.json`.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v2.7 подтверждён. Backend полностью протестирован и готов к интеграции с frontend.

---

**Итог:**  
Модуль II формирует полную серверную основу проекта: базы данных, REST API, escrow, безопасность, события и мониторинг.  
После завершения всех подмодулей система готова к интеграции с frontend.

# III. Frontend — структура, UI и маршрутизация

## 1. Цель модуля
Реализовать клиентскую часть платформы: пользовательский интерфейс, маршрутизацию, взаимодействие с API и визуальную логику.  
Модуль отвечает за UX, дизайн, контексты и визуальную целостность всей системы.

---

## Подмодуль 3.1 — Инициализация фронтенда и структура проекта
**Описание:**  
Создание базового каркаса фронтенд-проекта на Next.js с использованием TypeScript.  
Настраивается базовая архитектура каталогов и конфигурация окружения.

**Включает:**
- Инициализацию проекта (`npx create-next-app` / `pnpm create next-app`).  
- Настройку TypeScript, ESLint, Prettier.  
- Создание базовой структуры `/src`, `/components`, `/lib`, `/store`.  
- Подключение глобальных стилей и TailwindCSS.  

**Результат:**  
Фронтенд готов к разработке интерфейсов и интеграции API.

### Задачи
#### GPT
- [x] Сгенерировать структуру проекта (`/src`, `/components`, `/lib`, `/store`).
- [x] Подготовить описание архитектуры фронтенда для notes.
- [x] Проверить соответствие структуре из project_plan.md.
#### Codex
- [x] Инициализировать Next.js проект с TypeScript.
- [x] Настроить ESLint, Prettier, TailwindCSS.
- [x] Добавить базовые зависимости и глобальные стили.
#### Серджиу
- [x] Проверить запуск и компиляцию проекта.
- [x] Настроить окружение `.env` и проверить API_URL.
- [x] Подтвердить корректность конфигурации.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”


## [v3.1] Context Lock — Frontend Initialized verified (2025-10-21)
**Описание:** Проведена финальная ревизия подмодуля 3.1. Фронтенд успешно инициализирован и подтверждена корректная работа базовой конфигурации.

### Выполнено
- Создан проект на Next.js с TypeScript.
- Настроены TailwindCSS, ESLint и Prettier.
- Добавлены глобальные стили и структура директорий `/src`, `/components`, `/lib`, `/store`.
- Настроены базовые конфигурационные файлы (`tsconfig.json`, `tailwind.config.js`, `.prettierrc`, `.eslintrc.json`).
- Проект успешно запускается локально на http://localhost:3000 и отображает страницу “UGC Marketplace — Frontend Initialized 🚀”.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v3.1 подтверждён. Фронтенд полностью инициализирован, структура проекта зафиксирована и готова к разработке UI-компонентов (подмодуль 3.2).

## [v3.1.1] Context Lock — Frontend Initialization reverified (2025-10-17)
**Описание:** Повторная проверка подмодуля 3.1 в соответствии с обновлённой архитектурой (Next.js 14, TS, TailwindCSS, ESLint/Prettier, страница входа).

**Результат:** Структура `/src`, конфигурации и стартовая страница подтверждены. Фронтенд готов к дальнейшим шагам модулей 3.2+.
---

**Описание:**  
Разработка библиотеки визуальных компонентов (UI kit) для повторного использования на всех страницах.  
Создаётся единый визуальный стиль интерфейса, адаптивный под все роли пользователей.

**Включает:**
- Компоненты: `Button`, `Input`, `Modal`, `Card`, `Badge`, `Table`.  
- Глобальные стили и темы (светлая/тёмная).  
- Поддержка shadcn/ui или Chakra UI.  
- Компоненты состояния: `Loader`, `EmptyState`, `ErrorState`.  

**Результат:**  
Базовая UI-библиотека, согласованная с дизайн-гайдом.

### Задачи
#### GPT
- [x] Подготовить список компонентов UI (Button, Input, Modal, Card, Badge, Table).
- [x] Составить структуру `/components/ui` и документацию.
- [x] Проверить единый стиль интерфейса и темы.
#### Codex
- [x] Реализовать базовые UI-компоненты и темы (светлая/тёмная).
- [x] Интегрировать shadcn/ui или Chakra UI.
- [x] Добавить состояния: Loader, EmptyState, ErrorState.
#### Серджиу
- [x] Проверить визуальное отображение UI-компонентов.
- [x] Утвердить дизайн и соответствие UI Guide.
- [x] Подключить UI-компоненты в базовые страницы.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v3.2] Context Lock — UI Framework verified (2025-10-22)
**Описание:** Проведена финальная ревизия подмодуля 3.2. Подтверждена корректная работа UI Framework и всех базовых компонентов интерфейса.

### Выполнено
- Реализованы UI-компоненты: Button, Input, Card, Modal, Badge, Table, Loader, EmptyState, ErrorState.
- Настроена темизация (light/dark) и сохранение выбора темы в localStorage.
- Создан компонент ThemeSwitcher и контекст ThemeProvider.
- Добавлены глобальные стили и расширенная цветовая палитра Tailwind.
- Создана демонстрационная страница `/ui`, отображающая все UI-компоненты.
- Проверена корректность отображения компонентов и адаптивность интерфейса.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v3.2 подтверждён. UI Framework и визуальная библиотека компонентов полностью готовы к использованию в маршрутах и интерфейсах следующих модулей (подмодуль 3.3 “Маршрутизация и структура страниц”).

## [v3.2.1] Context Lock — UI Framework restored and verified (2025-10-18)
**Описание:** Проведена повторная ревизия UI Framework с обновлением showcase, темизации и компонентов под текущую архитектуру.

**Результат:** Все UI-компоненты и контекст темы актуализированы, страница `/ui` отображает примеры, документация синхронизирована.
---

**Описание:**  
Реализация маршрутов и страниц по ролям пользователей.  
Определяются layout-компоненты, переходы и защита маршрутов.

**Включает:**
- Layout и Sidebar для ролей (creator, brand, admin и др.).  
- Навигация с проверкой роли (`useRoleRedirect`).  
- Публичные страницы: `/`, `/faq`, `/cases`, `/top-creators`.  
- Личные страницы: `/creator`, `/brand`, `/agent`, `/admin`, `/factory`.  

**Результат:**  
Полностью работающая маршрутизация с разграничением доступа по ролям.

### Задачи
#### GPT
- [x] Описать дерево маршрутов и layout-структуру.
- [x] Задокументировать роли и доступы.
- [x] Подготовить схему редиректов.
#### Codex
- [x] Реализовать маршрутизацию (App Router Next.js).
- [x] Добавить Sidebar и Header для всех ролей.
- [x] Настроить `useRoleRedirect` для защиты маршрутов.
#### Серджиу
- [x] Проверить навигацию и маршруты в UI.
- [x] Подтвердить корректность разграничения ролей.
- [x] Тестировать переходы между страницами.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v3.3] Context Lock — Routing and Page Structure verified (2025-10-23)
**Описание:** Проведена финальная ревизия подмодуля 3.3. Подтверждена корректная работа маршрутизации, layout и страниц ролей.

### Выполнено
- Реализована структура маршрутов App Router (Next.js) для всех ролей: creator, brand, agent, admin, factory.
- Настроены layout-компоненты (Header, Sidebar) с адаптивной навигацией и поддержкой темы.
- Добавлены публичные страницы: `/faq`, `/cases`, `/top-creators`.
- Реализованы страницы кабинетов ролей с тестовым контентом.
- Настроены `ProtectedRoute` и `useRoleRedirect` для проверки ролей и защиты маршрутов.
- Проверены переходы между страницами, адаптивность и светлая/тёмная темы.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v3.3 подтверждён. Маршрутизация и структура страниц полностью функционируют, фронтенд готов к интеграции с backend API (подмодуль 3.4 “Интеграция с API”).

---

## Подмодуль 3.4 — Интеграция с API
**Описание:**  
Связка фронтенда с backend API, реализация универсальных методов запросов и обработки ответов.  
Создаётся единый слой для взаимодействия с сервером.

**Включает:**
- Файл `lib/api.ts` с методом `apiRequest(endpoint, method, body)`.  
- Обработка токенов авторизации (Bearer).  
- Отображение ошибок (toast / модальные окна).  
- Интеграция SWR или React Query для запросов с кешированием.  

**Результат:**  
Фронтенд обменивается данными с сервером через централизованный API-слой.

### Задачи
#### GPT
- [x] Описать правила обмена данными фронт ↔ бэк.
- [x] Подготовить шаблон fetch-запроса (`apiRequest()`).
- [x] Задокументировать обработку ошибок и токенов.
#### Codex
- [x] Реализовать `lib/api.ts` и авторизацию Bearer.
- [x] Настроить SWR или React Query.
- [x] Добавить toast-уведомления об ошибках.
#### Серджиу
- [x] Проверить запросы к API (auth, campaigns, orders).
- [x] Убедиться в корректной обработке токенов.
- [x] Провести интеграционный тест фронт ↔ бэк.
- [x] Протестировать mock-логин без формы (creator/brand/admin).

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

```
## [fix] API Integration — login and role routing verified (2025-10-24)
**Описание:** Проведена финальная ревизия исправлений интеграции фронтенда с backend API. Подтверждена корректная работа входа, передачи ролей и маршрутизации.

### Выполнено
- Исправлены пути API и синхронизированы переменные окружения (`NEXT_PUBLIC_API_URL=http://127.0.0.1:8002`).
- Проверены эндпоинты `/api/auth/login`, `/api/auth/refresh`, `/api/auth/logout` — работают корректно.
- Настроен контекст авторизации и маршрутизация по ролям (creator, brand, admin).
- Ошибки API теперь безопасно обрабатываются (toast уведомления, без падения интерфейса).
- Добавлены тестовые данные для входа без формы (email: `slebronov@mail.ru`, пароль: `12322828`) для упрощённого тестирования.
- Подтверждена успешная авторизация и переход на соответствующие кабинеты.
- Обновлены changelog и tasks.

**Результат:**  
Исправление подтверждено. API интеграция работает стабильно, маршруты авторизации функционируют.  
⚠️ Вход по тестовым данным временный — необходимо заменить на полноценную форму логина в финальной версии.
```

---

## Подмодуль 3.5 — Личные кабинеты пользователей
**Описание:**  
Разработка основных интерфейсов для всех типов ролей.  
Каждый кабинет включает страницы, панели и состояния, описанные в `project_plan.md`.

**Включает:**
- **Креатор:** `/feed`, `/orders`, `/balance`, `/rating`, `/learning`.  
- **Бренд:** `/campaigns`, `/create`, `/analytics`, `/finance`.  
- **Агент:** `/creators`, `/reports`.  
- **Админ:** `/campaigns`, `/users`, `/finance`, `/analytics`.  
- **Контент-завод:** `/tasks`, `/calendar`.  

**Результат:**  
Интерфейсы ролей созданы и готовы к тестированию с реальным API.

### Задачи
#### GPT
- [x] Описать структуру экранов по ролям (creator, brand, agent, admin, factory).
- [x] Составить документ UX Flow для всех ролей.
- [x] Проверить логическую связность навигации.
#### Codex
- [x] Реализовать интерфейсы кабинетов по ролям.
- [x] Настроить API-вызовы для каждого кабинета.
- [x] Создать таблицы и карточки контента.
#### Серджиу
- [x] Проверить навигацию и данные по ролям.
- [x] Утвердить UI кабинетов после теста.
- [x] Подтвердить визуальное и функциональное соответствие.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v3.5] Context Lock — User Dashboards verified (2025-10-25)
**Описание:** Проведена финальная ревизия подмодуля 3.5. Подтверждена корректная работа личных кабинетов пользователей для всех ролей.

### Выполнено
- Реализованы личные кабинеты для ролей: creator, brand, agent, admin, factory.
- Каждая страница имеет собственные маршруты (`/creator/*`, `/brand/*`, `/agent/*`, `/admin/*`, `/factory/*`).
- Интерфейсы используют компоненты UI Kit (Card, Table, Loader, EmptyState, ErrorState).
- Интеграция с API активна — данные подгружаются через `useApi` и `apiRequest`.
- Sidebar и Breadcrumbs обновлены под соответствующие разделы.
- Проверены редиректы после входа и корректность отображения данных.
- Подтверждено, что ошибки API безопасно обрабатываются, интерфейс остаётся стабильным.
- Обновлены changelog и tasks.

**Результат:**  
Context Lock v3.5 подтверждён. Все кабинеты пользователей функционируют корректно, интеграция с API стабильна.  
Фронтенд готов к переходу в подмодуль 3.6 “Контексты и глобальное состояние”.
---

## Подмодуль 3.6 — Контексты и глобальное состояние
**Описание:**  
Настройка контекстов и стора для управления состоянием приложения.  
Определяются основные хранилища данных и логика обновлений.

**Включает:**
- Context API: `AuthContext`, `NotificationContext`, `ChatContext`, `ThemeContext`.  
- Zustand / Redux Toolkit — `userStore`, `campaignStore`, `orderStore`.  
- Хуки: `useAuth`, `useNotifications`, `useChat`, `useFetch`.  

**Результат:**  
Единая система состояний, обеспечивающая синхронную работу всех интерфейсов.

### Задачи
#### GPT
- [x] Подготовить описание структуры Context API и стора.
- [x] Составить документацию для AuthContext и NotificationContext.
- [x] Проверить взаимосвязи стора и UI.
#### Codex
- [x] Реализовать AuthContext, NotificationContext, ChatContext, ThemeContext.
- [x] Настроить Zustand/Redux Toolkit (userStore, campaignStore, orderStore).
- [x] Добавить хуки useAuth, useNotifications, useChat, useFetch.
#### Серджиу
- [x] Проверить корректность контекстов и хранилищ.
- [x] Убедиться, что данные обновляются в UI.
- [x] Тестировать переключение тем и уведомления.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v3.6] Context Lock — Global Contexts and State Management verified (2025-10-26)
**Описание:** Проведена финальная ревизия подмодуля 3.6. Подтверждена корректная работа контекстов и глобального управления состоянием приложения.

### Выполнено
- Реализованы контексты: AuthProvider, NotificationProvider, ChatProvider, ThemeProvider.
- Контексты подключены через `app/providers.tsx` и обеспечивают синхронное обновление интерфейса.
- Настроены глобальные сторы Zustand (`userStore`, `campaignStore`, `orderStore`).
- Созданы хуки `useAuth`, `useNotifications`, `useChat`, `useFetch` для работы с API и UI.
- Проверено мгновенное обновление данных при действиях пользователя и переключении ролей.
- Подтверждена работа уведомлений, темы и хранения данных пользователя.
- Обновлены changelog, readme и project_plan.

**Результат:**  
Context Lock v3.6 подтверждён. Контексты и глобальные сторы функционируют корректно, интерфейс синхронизируется с API в реальном времени.  
Фронтенд готов к переходу в подмодуль 3.7 “API Integration Testing”.
---

## Подмодуль 3.7 — API Integration Testing
**Описание:**  
Проверка корректности интеграции фронтенда с backend.  
Тестируются все запросы, авторизация и получение данных.

**Включает:**
- Тесты с mock-сервером или staging API.  
- Проверку GET/POST/PUT/PATCH-запросов.  
- Автоматические проверки ошибок и статус-кодов.  

**Результат:**  
Фронтенд подтверждает корректное взаимодействие с backend API.

### Задачи
#### GPT
- [x] Подготовить сценарии тестирования API во фронтенде.
- [x] Составить чек-лист для mock-сервера.
- [x] Задокументировать тестовые эндпоинты и статусы.
#### Codex
- [x] Реализовать mock-сервер или использовать staging API.
- [x] Написать интеграционные тесты для запросов.
- [x] Проверить корректность обработки ошибок и статусов.
#### Серджиу
- [x] Провести ручное тестирование API-вызовов.
- [x] Подтвердить стабильность интеграции.
- [x] Обновить документацию при изменениях API.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”
## [v3.7] Context Lock — API Integration Testing verified (2025-10-27)
**Описание:** Проведена финальная ревизия подмодуля 3.7. Подтверждена корректная работа интеграции фронтенда с backend API и успешное выполнение автоматических тестов.

### Выполнено
- Реализованы интеграционные тесты API (frontend/tests/api-integration.test.ts).
- Проверены маршруты: Auth, Campaigns, Payments, Notifications, Admin.
- Подтверждено, что все запросы направляются на NEXT_PUBLIC_API_URL=http://127.0.0.1:8002.
- Контексты и сторы обновляют UI синхронно при изменениях данных.
- Ошибки и статусы API корректно обрабатываются (toast-уведомления, безопасный возврат из apiRequest).
- Тесты создают временных пользователей (brand/admin) и подтверждают корректность ответов API.
- Обновлены changelog, readme, project_plan и tasks.

**Результат:**  
Context Lock v3.7 подтверждён. Интеграция фронтенда и backend API полностью протестирована и функционирует корректно.  
Платформа готова к переходу в подмодуль 3.8 “Тестирование интерфейса и UX”.

---

## Подмодуль 3.8 — Тестирование интерфейса и UX
**Описание:**  
Проверка визуальной и пользовательской логики.  
Включает unit, integration и end-to-end тестирование.

**Включает:**
- Jest / Testing Library — unit-тесты компонентов.  
- Cypress — e2e сценарии (авторизация, заказы, кампании).  
- Snapshot-тесты для UI-компонентов.  

**Результат:**  
Фронтенд проходит визуальное и функциональное тестирование.

### Задачи
#### GPT
- [x] Сформировать сценарии UX-тестов (user flow).
- [x] Описать юзкейсы для e2e тестов.
- [x] Подготовить стандарты визуальной проверки UI.
#### Codex
- [x] Реализовать unit-тесты (Jest / Testing Library).
- [x] Настроить Cypress для e2e сценариев.
- [x] Подготовить snapshot-тесты компонентов.
#### Серджиу
- [x] Провести UX-тестирование с пользователями.
- [x] Проверить корректность UI на разных устройствах.
- [x] Подтвердить визуальную стабильность интерфейса.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

## [v3.8] Context Lock — UX & UI Testing verified (2025-10-28)
**Описание:** Проведена финальная ревизия подмодуля 3.8. Подтверждена стабильность интерфейса, корректная работа UX Flow и полное покрытие тестами UI.

### Выполнено
- Реализованы unit и snapshot тесты UI-компонентов (Jest + Testing Library).
- Добавлены e2e тесты Cypress для пользовательских сценариев: вход по ролям, навигация, уведомления, переключение тем и logout.
- Подтверждено, что интерфейс проходит UX Flow без ошибок.
- Настроена инфраструктура для визуальных снимков и адаптивных проверок.
- Проверено взаимодействие фронтенда с backend при полном сценарии использования.
- Обновлены readme, project_plan, changelog и tasks.

**Результат:**  
Context Lock v3.8 подтверждён. Интерфейс стабилен, UX-поток работает корректно, визуальные и функциональные тесты выполняются успешно.  
Платформа готова к переходу в подмодуль 3.9 “Оптимизация и сборка”.

---

## Подмодуль 3.9 — Оптимизация и сборка
**Описание:**  
Финальная настройка сборки, деплоя и оптимизации фронтенда.  
Проводится оптимизация загрузки и производительности.

**Включает:**
- Настройку `next.config.js` и `vercel.json`.  
- Lazy-loading, оптимизация изображений.  
- Lighthouse-аудит.  
- Настройку деплоя на Vercel / Netlify.  

**Результат:**  
Фронтенд готов к размещению в продакшне и интеграции с backend.

### Задачи
#### GPT
- [x] Составить план оптимизации производительности (Lighthouse, bundle size).
- [x] Подготовить документацию по деплою (Vercel / Netlify).
- [x] Проверить структуру конфигурационных файлов.
#### Codex
- [x] Настроить `next.config.js` и `vercel.json`.
- [x] Реализовать lazy-loading и оптимизацию изображений.
- [x] Настроить скрипты сборки и деплоя.
#### Серджиу
- [x] Проверить результаты Lighthouse-аудита.
- [x] Утвердить релизную сборку и деплой.
- [x] Подтвердить стабильность продакшн-версии.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”


## [v3.9] Context Lock — Frontend Optimization and Build verified (2025-10-29)
**Описание:** Проведена финальная ревизия подмодуля 3.9. Подтверждена корректная работа оптимизации и сборки фронтенда.

### Выполнено
- Настроены параметры Next.js (`reactStrictMode`, `swcMinify`, `compress`, `output: "standalone"`).
- Реализованы lazy-loading и оптимизация изображений.
- Подготовлены конфигурации деплоя (`next.config.js`, `vercel.json`).
- Включено кеширование, минификация и bundle-анализ.
- Lighthouse Performance ≥ 90 подтвержден.
- Проверено взаимодействие фронтенда с backend API после сборки.
- Обновлены changelog, readme, project_plan и tasks.

**Результат:**  
Context Lock v3.9 подтверждён. Фронтенд оптимизирован, готов к продакшн-сборке и деплою.  
Модуль III “Frontend” завершён, проект готов к переходу в модуль IV “Коммуникации и интеграции”.

**Итог:**  
Модуль III формирует клиентскую часть проекта — интерфейсы, маршрутизацию, состояния и интеграцию с API.  
После завершения всех подмодулей платформа готова к подключению коммуникаций и интеграций (Модуль IV).

# IV. Коммуникации и интеграции

## 1. Цель модуля
Реализовать систему взаимодействия между пользователями (чаты, уведомления, телеграм-интеграции) и интегрировать внешние сервисы (escrow, банкинг, модерация).  
Модуль отвечает за внутреннюю коммуникацию, нотификации и связь с внешними системами.

---

## Подмодуль 4.1 — Чат и внутренняя коммуникация
**Описание:**  
Создание внутренней системы обмена сообщениями между брендами, креаторами и агентами.  
Определяются форматы сообщений, структура хранения и логика уведомлений.

**Включает:**
- REST API `/api/chat/send`, `/api/chat/:id`.  
- Реализация компонент `ChatBox` и `MessageList` во фронтенде.  
- Поддержка real-time сообщений (WebSocket / Socket.IO).  
- Хранение истории переписки в базе (`messages`).  
- Фильтрация и группировка по заказам/кампаниям.

**Результат:**  
Рабочая система чатов между всеми участниками платформы.

### Задачи
#### GPT
- [ ] Разработать архитектуру чата (структура сообщений, модели, API).
- [ ] Подготовить документацию по REST и WebSocket интерфейсам.
- [ ] Проверить совместимость с frontend.
#### Codex
- [ ] Реализовать API `/api/chat/send`, `/api/chat/:id`.
- [ ] Настроить WebSocket / Socket.IO для real-time обмена.
- [ ] Создать таблицу `messages` в базе данных.
- [ ] Разработать компоненты `ChatBox` и `MessageList`.
#### Серджиу
- [ ] Проверить работоспособность real-time сообщений.
- [ ] Провести тест чата между разными ролями (бренд / креатор / агент).
- [ ] Подтвердить корректное хранение сообщений и их отображение.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 4.2 — Уведомления и центр нотификаций
**Описание:**  
Реализация системы уведомлений для всех типов пользователей.  
Обеспечивается централизованное хранение и отображение статусов действий.

**Включает:**
- Таблица `notifications` (user_id, type, title, content, is_read).  
- API `/api/notifications` (список, обновление статусов).  
- Интеграция с Telegram через Webhook.  
- Веб-уведомления и Toast-интерфейс на фронтенде.  
- Панель уведомлений в каждом кабинете.

**Результат:**  
Единый центр уведомлений и алертов, работающий во всех ролях системы.

### Задачи
#### GPT
- [ ] Подготовить архитектуру системы уведомлений (таблица, типы, триггеры).
- [ ] Описать API `/api/notifications`.
- [ ] Сформулировать схему интеграции с Telegram Webhook.
#### Codex
- [ ] Реализовать API уведомлений и хранение в таблице `notifications`.
- [ ] Настроить push-уведомления и Toast-интерфейс на фронтенде.
- [ ] Интегрировать Telegram Webhook для дублирования уведомлений.
#### Серджиу
- [ ] Проверить корректность уведомлений во всех ролях.
- [ ] Подтвердить доставку в Telegram.
- [ ] Утвердить визуальный вид панели уведомлений.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 4.3 — Telegram Bot Integration
**Описание:**  
Разработка Telegram-бота для уведомлений и быстрых действий пользователей.  
Бот дублирует важные события: новые кампании, отклики, выплаты, ошибки.

**Включает:**
- Telegram Bot API и Webhook `/api/webhooks/telegram`.  
- Поддержка команд `/start`, `/profile`, `/balance`.  
- Отправка уведомлений при событиях (новая кампания, видео утверждено, выплата).  
- Настройка шаблонов сообщений.  
- Безопасная авторизация через токен Telegram user_id.

**Результат:**  
Telegram-бот синхронизирован с системой и доставляет уведомления в реальном времени.

### Задачи
#### GPT
- [ ] Разработать архитектуру Telegram-бота и его команды.
- [ ] Подготовить спецификацию Webhook `/api/webhooks/telegram`.
- [ ] Сформулировать шаблоны уведомлений.
#### Codex
- [ ] Реализовать Telegram Bot API и Webhook.
- [ ] Добавить команды `/start`, `/profile`, `/balance`.
- [ ] Настроить обработку событий и отправку уведомлений.
#### Серджиу
- [ ] Зарегистрировать и подключить Telegram-бота.
- [ ] Проверить отправку уведомлений в реальном времени.
- [ ] Утвердить тексты и оформление сообщений.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 4.4 — Escrow API Integration (платежная система)
**Описание:**  
Интеграция с платёжной системой “Точка Банк” (mock или sandbox) для заморозки, перевода и разблокировки средств.  
Добавляется обработка ошибок и обратных уведомлений.

**Включает:**
- REST API `/api/payments`, `/api/payouts`, `/api/webhooks/bank`.  
- Механика hold/release/payout.  
- Логирование транзакций.  
- Webhook обратных уведомлений.  
- Отображение балансов в UI.

**Результат:**  
Финансовая система работает в автоматическом режиме с контролем всех операций escrow.

### Задачи
#### GPT
- [ ] Подготовить спецификацию API для интеграции с Точка Банк (mock/sandbox).
- [ ] Описать процессы hold, release и payout.
- [ ] Составить сценарии тестовых транзакций.
#### Codex
- [ ] Реализовать REST API `/api/payments`, `/api/payouts`, `/api/webhooks/bank`.
- [ ] Настроить обработку ошибок и логирование транзакций.
- [ ] Добавить mock-интеграцию с банком.
#### Серджиу
- [ ] Провести тестовые транзакции (hold → release → payout).
- [ ] Проверить баланс и обновление данных в UI.
- [ ] Убедиться в безопасности и стабильности платёжных операций.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 4.5 — Админ-инструменты модерации
**Описание:**  
Расширение возможностей админов по контролю за пользователями, заказами и контентом.  
Интерфейсы модерации интегрируются с внутренней логикой чатов и уведомлений.

**Включает:**
- Панель модерации `/admin/moderation`.  
- Возможность блокировки пользователей и кампаний.  
- Отправка уведомлений при нарушениях.  
- Просмотр истории действий.  
- Логи событий (actions log).  

**Результат:**  
Модераторы и администраторы получают полный контроль над коммуникацией и безопасностью системы.

### Задачи
#### GPT
- [ ] Сформулировать архитектуру панели модерации (права, уровни доступа, API).
- [ ] Описать логику уведомлений при блокировках.
- [ ] Подготовить документацию по действиям модераторов.
#### Codex
- [ ] Реализовать панель `/admin/moderation`.
- [ ] Добавить API для блокировки пользователей и кампаний.
- [ ] Интегрировать систему уведомлений о нарушениях.
#### Серджиу
- [ ] Проверить действия модераторов (блокировка, уведомления).
- [ ] Утвердить интерфейс панели модерации.
- [ ] Провести тест на корректность логов действий.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 4.6 — Мониторинг событий и логирование
**Описание:**  
Реализация системы отслеживания событий, ошибок и состояния сервисов.  
Включает внутренние алерты и отчётность.

**Включает:**
- Логирование системных событий (Winston / Loguru).  
- Отчёты по сбоям и ошибкам API.  
- Cron для проверки активности WebSocket и Telegram.  
- Мониторинг uptime (Grafana / Prometheus).  

**Результат:**  
Система фиксирует и анализирует все коммуникационные события, обеспечивая прозрачность и стабильность работы.

### Задачи
#### GPT
- [ ] Сформулировать требования к логированию (Winston/Loguru) и отчётности.
- [ ] Подготовить архитектуру cron-задач и алертов.
- [ ] Описать схему интеграции с Grafana / Prometheus.
#### Codex
- [ ] Реализовать логирование системных событий и ошибок.
- [ ] Настроить cron-задачи для проверки сервисов (WebSocket, Telegram).
- [ ] Интегрировать Grafana / Prometheus для мониторинга uptime.
#### Серджиу
- [ ] Проверить корректность логов и отчётов.
- [ ] Настроить уведомления об ошибках и сбоях.
- [ ] Утвердить систему мониторинга и дашборды.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

**Итог:**  
Модуль IV обеспечивает внутреннюю и внешнюю коммуникацию проекта: чаты, уведомления, Telegram, escrow и админ-модерацию.  
После выполнения всех подмодулей платформа становится интерактивной, безопасной и связанной с внешними системами.

# V. Аналитика и AI-система

## 1. Цель модуля
Модуль предназначен для внедрения системы автоматической аналитики контента, AI-оценки эффективности роликов и интеграции с внешними платформами.  
На текущем этапе создаётся структура и описание будущих возможностей.

---

## Подмодуль 5.1 — Заглушка: Video Metrics System
**Описание:**  
В этом разделе будет размещена система парсинга просмотров и вовлечённости из YouTube, TikTok, VK и других платформ.  
Предусмотрен сбор метрик (просмотры, лайки, ER) по ссылкам на ролики креаторов.

### Задачи
#### GPT
- [ ] Подготовить архитектурное описание системы парсинга метрик.
- [ ] Определить источники данных (YouTube, TikTok, VK, Instagram).
- [ ] Составить план API-интеграций для получения просмотров, ER и лайков.
#### Codex
- [ ] Создать тестовую структуру API `/api/metrics` (заглушка).
- [ ] Реализовать mock-функцию сбора данных с платформ.
- [ ] Настроить базу для хранения метрик (таблица `video_metrics`).
#### Серджиу
- [ ] Подтвердить корректность концепции парсинга.
- [ ] Утвердить список поддерживаемых платформ.
- [ ] Подготовить тестовые ссылки для будущих проверок.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 5.2 — Заглушка: AI Performance Analyzer
**Описание:**  
Планируется модуль AI, который будет анализировать эффективность контента и сопоставлять результаты видео с продажами брендов.  
Используется машинное обучение для рекомендаций и прогнозов.

### Задачи
#### GPT
- [ ] Подготовить концепцию AI-модуля (архитектура и алгоритмы).
- [ ] Определить ключевые метрики эффективности контента.
- [ ] Разработать схему анализа корреляции метрик с продажами.
#### Codex
- [ ] Создать заготовку AI-сервиса (`/api/ai/analyze`).
- [ ] Реализовать mock-анализ данных (псевдоалгоритм).
- [ ] Настроить логику сохранения результатов в таблице `ai_reports`.
#### Серджиу
- [ ] Проверить бизнес-логику анализа и её применимость.
- [ ] Утвердить набор показателей (ROI, CTR, ER, конверсия).
- [ ] Подготовить примеры для обучения модели (будущее расширение).

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 5.3 — Заглушка: WB Integration Layer
**Описание:**  
Предусмотрено подключение к Wildberries API для получения данных по продажам и трафику.  
Позволит строить графики связи “контент → продажи”.

### Задачи
#### GPT
- [ ] Подготовить спецификацию интеграции с Wildberries API.
- [ ] Описать формат данных по продажам и трафику.
- [ ] Составить архитектуру связи "контент → продажи".
#### Codex
- [ ] Реализовать mock-интерфейс `/api/wb/statistics`.
- [ ] Настроить хранение данных в таблице `wb_stats`.
- [ ] Добавить функцию для корреляции метрик видео и продаж.
#### Серджиу
- [ ] Проверить ключи доступа к WB API.
- [ ] Утвердить параметры выгрузки (период, артикулы, продажи).
- [ ] Подготовить пример выгрузки данных для тестирования.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

## Подмодуль 5.4 — Заглушка: Dashboard & Visualization
**Описание:**  
Раздел аналитических отчётов и визуализаций (просмотры, конверсии, ROI).  
На этапе MVP представлен как placeholder для будущего интерфейса аналитики.

### Задачи
#### GPT
- [ ] Подготовить концепцию визуализации аналитики (графики, таблицы, показатели).
- [ ] Описать структуру Dashboard API.
- [ ] Составить план интеграции с будущим AI-модулем.
#### Codex
- [ ] Реализовать mock-интерфейс `/api/dashboard` (заглушка).
- [ ] Создать базовые графики и карточки данных на фронтенде.
- [ ] Настроить обновление данных из таблиц `video_metrics`, `wb_stats`.
#### Серджиу
- [ ] Утвердить дизайн аналитического интерфейса.
- [ ] Проверить корректность mock-отчётов.
- [ ] Подтвердить готовность платформы к будущему AI-модулю.

**После выполнения:**  
> “Обнови task.md и changelog.md, зафиксируй изменения.”  
**Ревизия GPT:**  
> “GPT, проверь актуальность всех файлов notes относительно состояния проекта.”

---

**Итог:**  
Модуль V зарезервирован под будущие инструменты аналитики и AI-систему.  
Он будет доработан в следующих версиях проекта (Context Lock v2.0 и выше).
